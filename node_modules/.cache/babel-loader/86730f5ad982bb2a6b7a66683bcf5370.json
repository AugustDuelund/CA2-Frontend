{"ast":null,"code":"var URL=\"http://localhost:8080/CA2_Backend\";function handleHttpErrors(res){if(!res.ok){return Promise.reject({status:res.status,fullError:res.json()});}return res.json();}var apiFacade=function apiFacade(){var fetchData=function fetchData(endpoint,updateAction,SetErrorMessage){var options=makeOptions(\"GET\",true);//True add's the token\nreturn fetch(URL+\"/api/\"+endpoint,options).then(handleHttpErrors).then(function(data){return updateAction(data);}).catch(function(err){if(err.status){console.log(err);err.fullError.then(function(e){return SetErrorMessage(e.code+\": \"+e.message);});}else{SetErrorMessage(\"Network error\");}});};var login=function login(user,password,setLoggedIn,setErrorMessage){var options=makeOptions(\"POST\",true,{username:user,password:password});return fetch(URL+\"/api/login\",options).then(handleHttpErrors).then(function(res){setToken(res.token);setLoggedIn(true);setErrorMessage('Logged in');}).catch(function(err){if(err.status){err.fullError.then(function(e){return setErrorMessage(e.code+': '+e.message);});}else{setErrorMessage('Network error');}});};// Security funktionalitet\nvar setToken=function setToken(token){localStorage.setItem('jwtToken',token);};var getToken=function getToken(){return localStorage.getItem('jwtToken');};var loggedIn=function loggedIn(){var loggedIn=getToken()!=null;return loggedIn;};var logout=function logout(){localStorage.removeItem(\"jwtToken\");};var getUserRoles=function getUserRoles(){var token=getToken();if(token!=null){var payloadBase64=getToken().split('.')[1];var decodedClaims=JSON.parse(window.atob(payloadBase64));var roles=decodedClaims.roles;return roles;}else return\"\";};var hasUserAccess=function hasUserAccess(neededRole,loggedIn){var roles=getUserRoles().split(',');return loggedIn&&roles.includes(neededRole);};var makeOptions=function makeOptions(method,addToken,body){var opts={method:method,headers:{\"Content-type\":\"application/json\",'Accept':'application/json'}};if(addToken&&loggedIn()){opts.headers[\"x-access-token\"]=getToken();}if(body){opts.body=JSON.stringify(body);}return opts;};return{makeOptions:makeOptions,fetchData:fetchData,setToken:setToken,getToken:getToken,loggedIn:loggedIn,login:login,logout:logout,getUserRoles:getUserRoles,hasUserAccess:hasUserAccess};};var facade=apiFacade();export default facade;","map":{"version":3,"sources":["/Users/aggerjrduelund/Desktop/CA2/CA2-Fall-Frontend/src/facade.js"],"names":["URL","handleHttpErrors","res","ok","Promise","reject","status","fullError","json","apiFacade","fetchData","endpoint","updateAction","SetErrorMessage","options","makeOptions","fetch","then","data","catch","err","console","log","e","code","message","login","user","password","setLoggedIn","setErrorMessage","username","setToken","token","localStorage","setItem","getToken","getItem","loggedIn","logout","removeItem","getUserRoles","payloadBase64","split","decodedClaims","JSON","parse","window","atob","roles","hasUserAccess","neededRole","includes","method","addToken","body","opts","headers","stringify","facade"],"mappings":"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","sourcesContent":["const URL = \"http://localhost:8080/CA2_Backend\";\n\nfunction handleHttpErrors(res)\n{\n    if (!res.ok)\n    {\n        return Promise.reject({ status: res.status, fullError: res.json() })\n    }\n    return res.json();\n}\n\nlet apiFacade = () =>\n{\n\n    const fetchData = (endpoint, updateAction, SetErrorMessage) =>\n    {\n        const options = makeOptions(\"GET\", true); //True add's the token\n        return fetch(URL + \"/api/\" + endpoint, options)\n            .then(handleHttpErrors)\n            .then((data) => updateAction(data))\n            .catch(err =>\n            {\n                if (err.status)\n                {\n                    console.log(err)\n                    err.fullError.then(e => SetErrorMessage(e.code + \": \" + e.message))\n                }\n                else { SetErrorMessage(\"Network error\"); }\n            })\n    }\n\n    const login = (user, password, setLoggedIn, setErrorMessage) =>\n    {\n        const options = makeOptions(\"POST\", true, { username: user, password: password });\n        return fetch(URL + \"/api/login\", options)\n            .then(handleHttpErrors)\n            .then(res =>\n            {\n                setToken(res.token)\n                setLoggedIn(true);\n                setErrorMessage('Logged in');\n            })\n            .catch((err) =>\n            {\n                if (err.status)\n                {\n                    err.fullError.then((e) => setErrorMessage(e.code + ': ' + e.message));\n                } else\n                {\n                    setErrorMessage('Network error');\n                }\n            });\n    }\n\n    // Security funktionalitet\n\n    const setToken = (token) =>\n    {\n        localStorage.setItem('jwtToken', token)\n    }\n    const getToken = () =>\n    {\n        return localStorage.getItem('jwtToken')\n    }\n    const loggedIn = () =>\n    {\n        const loggedIn = getToken() != null;\n        return loggedIn;\n    }\n    const logout = () =>\n    {\n        localStorage.removeItem(\"jwtToken\");\n    }\n\n    const getUserRoles = () =>\n    {\n        const token = getToken()\n        if (token != null)\n        {\n            const payloadBase64 = getToken().split('.')[1]\n            const decodedClaims = JSON.parse(window.atob(payloadBase64))\n            const roles = decodedClaims.roles\n            return roles\n        } else return \"\"\n    }\n\n    const hasUserAccess = (neededRole, loggedIn) =>\n    {\n        const roles = getUserRoles().split(',')\n        return loggedIn && roles.includes(neededRole)\n    }\n\n    const makeOptions = (method, addToken, body) =>\n    {\n        var opts = {\n            method: method,\n            headers: {\n                \"Content-type\": \"application/json\",\n                'Accept': 'application/json',\n            }\n        }\n        if (addToken && loggedIn())\n        {\n            opts.headers[\"x-access-token\"] = getToken();\n        }\n        if (body)\n        {\n            opts.body = JSON.stringify(body);\n        }\n        return opts;\n    }\n\n    return {\n        makeOptions,\n        fetchData,\n        setToken,\n        getToken,\n        loggedIn,\n        login,\n        logout,\n        getUserRoles,\n        hasUserAccess,\n    }\n\n}\n\nconst facade = apiFacade()\n\nexport default facade"]},"metadata":{},"sourceType":"module"}